<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>
    Currency SMA System
  </title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
    integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<style>
  .navbar{
            /* background-color: rgb(81, 4, 153); */
            background-color: #378a0d;
            opacity: 0.8;
            position: sticky;
            
        }
  body {
    background: #FFFF00;  /* fallback for old browsers */
  }
  body::after {
  content: "";
  opacity: 0.1;
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
  position: absolute;
  z-index: -1;   
}


</style>

</head>

<body onload="fetchCurrencies()">
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
  <a class="navbar-brand" href="#">Simple Moving Average</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNavDropdown">
    <ul class="navbar-nav ml-auto">
      <li class="nav-item active">
        <a class="nav-link" href="#intro">Introduction <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#tut">Tutorial</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#calc">Calculate</a>
      </li>
    </ul>
  </div>
</nav>
  <br><br><br>
  <div class="container">
    <div class="row">        
      <div class="col-sm-12" id="intro">
          <h1 id="intro">Introduction</h1>
          <p style="color: black;">
          Lorem ipsum dolor sit amet, consectetur adipiscing elit, 
          sed do eiusmod tempor incididunt ut labore 
          et dolore magna aliqua. Ut enim ad minim veniam, 
          quis nostrud exercitation ullamco laboris nisi ut 
          aliquip ex ea commodo consequat.
          </p>
      </div>
    </div>
    <div>
            <h1 id="tut" style="text-align:center;">Tutorial:</h1>
            <h3>Step 1:</h3>
            <h3>Step 2:</h3>
            <h3>Step 3:</h3>
            <h3>Step 4:</h3>
        </div><br>
    <div class="row">
      <div class="col-md-3"><button type="button" class="btn btn-primary " onclick="viewcontent()">VIEW ENTRIES</button></div>
      <div class="col-md-3"><button type="button" class="btn btn-danger " onclick="addcontent()">ADD NEW ENTRY</button></div>
      <div class="col-md-3"><button type="button" class="btn btn-warning " onclick="editcontent()">EDIT AN ENTRY</button></div>
      <div class="col-md-3"><button type="button" class="btn btn-secondary" onclick="deletecontent()">DELETE AN ENTRY</button></div>
    </div>
    <br><br><br>
    
    <div class="row">

        <div class="col-md-4">
          <div class="add">
            <form>
              <div class="form-group">
                <label>Currency Name</label>
                <select name="currency-name" id="currencyName" class="form-control">
                  <option></option>
                  <option value="EUR/USD">EUR/USD</option>
                  <option value="GBP/USD">GBP/USD</option>
                  <option value="EUR/GBP">EUR/GBP</option>
                </select>
              </div>
              <div class="form-group">
                <label>Currency ID</label>
                <input type="text" class="form-control" name="currency-id" id="currencyId" placeholder="Enter a unique currency ID">
              </div>
              <div class="form-group">
                <label>CURRENCY EXCHANGE RATE</label>
                <input type="number" class="form-control" name="currency-rate" id="currencyRate" placeholder="Enter currency exchange rate">
              </div>
              <input type="submit" class="mx-auto btn btn-primary" value="ADD" id="submit">
            </form>
          </div>

          <div class="view">
                <div class="text-center mt-3">
                  <h5 class="text-center">Search Currency Record</h5>
                  <div class="form-group form-group-lg">
                    <input type="text" id="search" class="form-control mt-4" placeholder="Enter currency ID">
                  </div>
                  <div id="match-list"></div>
                </div>
            <table id="content" class="table table-striped  text-center mt-3"></table>
          </div>

          <div class="edit">
            <div class="text-center mt-3">
              <h5>Search & Edit Currency Record</h5>
              <p>(To edit currency record ensure only the desired record appears on the screen)</p>
              <p>(Click on the Name or Rate respectively to edit)</p>
              <div class="form-group form-group-lg">
                <input type="text" id="editSearch" class="form-control mt-4" placeholder="Enter currency ID">
              </div>
              <div id="edit-list"></div>
            </div>
          </div>

          <div class="delete">
            <div class="text-center mt-3">
              <h6>Search & Delete Currency Record</h6>
              <div class="form-group form-group-lg">
                <input type="text" id="deleteSearch" class="form-control mt-4" placeholder="Enter currency ID">
              </div>
              <div id="delete-list"></div>
            </div>
          </div>
        </div>
      <br><br>

      <div class="col-md-8 text-center ml-auto">
        <h6>
          A GRAPH DISPLAYING CURRENCY SMAs
        </h6>
        <p>* To update the chart refresh the page</p>
        <canvas id="myChart" style=""></canvas>
      </div>
    </div>
  </div>

  {{!-- ------------------------------------------- --}}
  {{!-- Chart.js Script tag --}}
  <script>
var myurl;
$.getJSON("/currencies", function(data) {
  myurl = data;
  const average = 5;
  var marylin = [];
  var manson = [];
  var celeste = [];

  const currencyExRt = [24,34,66,55,77,88,99,44,22,56,87,34,67]
  const marylinExRt = []
  const mansonExRt = []
  const celesteExRt = []


  const the_labels = []

  const marylinmovingAverage = [];
  const mansonmovingAverage = [];
  const celestemovingAverage = [];


  for (var i = 0; i < myurl.length; i++){
    if("EUR/GBP" === myurl[i]["name"]){
      manson.push(parseInt(myurl[i]["rate"]) )
    }
  }
  for (var i = 0; i < myurl.length; i++){
    if("GBP/USD" === myurl[i]["name"]){
      marylin.push(parseInt(myurl[i]["rate"]) )
    }
  }
  for (var i = 0; i < myurl.length; i++){
    if("EUR/USD" === myurl[i]["name"]){
      celeste.push(parseInt(myurl[i]["rate"]) )
    }
  }

  for (i=0; i < marylin.length; i++) {
      const fivedatapoints = marylin.slice(i, average + i);
      marylinmovingAverage.push(fivedatapoints.reduce((total, num) => total + num) / average);
      // console.log(marylinmovingAverage);
  }
  for (i=0; i < manson.length; i++) {
      const fivedatapoints = manson.slice(i, average + i);
      mansonmovingAverage.push(fivedatapoints.reduce((total, num) => total + num) / average);
      // console.log(mansonmovingAverage);
  }
  for (i=0; i < celeste.length; i++) {
      const fivedatapoints = celeste.slice(i, average + i);
      celestemovingAverage.push(fivedatapoints.reduce((total, num) => total + num) / average);
      // console.log(celestemovingAverage);
  }


// console.log(Math.max(marylinmovingAverage.length, mansonmovingAverage.length, celestemovingAverage.length));
  const randomlabels = Math.max(marylinmovingAverage.length, mansonmovingAverage.length, celestemovingAverage.length);
  for (i=1; i < randomlabels; i++){
    the_labels.push(`A${i}`)
    // console.log('darknexx')
  }


    var ctx = document.getElementById("myChart").getContext('2d');

    var myChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [...the_labels], // THIS IS WHERE WE ARE GOING TO EDIT
        datasets: [
          {
          label: 'EUR/GBP',
          data: [...mansonmovingAverage], // THIS IS WHERE WE ARE GOING TO EDIT
          fill: false,
          borderColor: 'rgb(75, 192, 192)',
          tension: 0.1
          },
          {
            label: 'GBP/USD',
            data: [...marylinmovingAverage], // THIS IS WHERE WE ARE GOING TO EDIT
            fill: false,
            borderColor: 'rgb(255, 0, 0)',
            tension: 0.1
          },
          {
            label: 'EUR/USD',
            data: [...celestemovingAverage], // THIS IS WHERE WE ARE GOING TO EDIT
            fill: false,
            borderColor: 'purple',
            tension: 0.1
          }
        ]
      },
      options: {
        scales: {
          yAxes: [{
            ticks: {
              beginAtZero: true
            }
          }]
        }
      }
    });
});

  </script>


<script>


</script>


  <script type="text/javascript" src="index.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
</body>

</html>
